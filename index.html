<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>左右判定テスト</title>
<style>
body { text-align:center; font-family:sans-serif; }
img { max-width:90%; max-height:60vh; }
button { font-size:24px; margin:10px; padding:10px 30px; }
</style>
</head>

<body>

<h2 id="counter"></h2>
<img id="img"><br>

<button onclick="answer('L')">左</button>
<button onclick="answer('R')">右</button>

<script>
// ===== 問題データ（あとで40枚に変更） =====
const problems = [
  {file:"img1.jpg", correct:"L"},
  {file:"img2.jpg", correct:"R"},
  {file:"img3.jpg", correct:"L"},
  {file:"img4.jpg", correct:"R"},
  {file:"img5.jpg", correct:"L"}
];

// ===== ランダム20問 =====
const shuffled = [...problems].sort(() => 0.5 - Math.random());
const questions = shuffled.slice(0, 20);

let index = 0;
let score = 0;
const answers = [];

function show(){
  document.getElementById("counter").textContent =
    `問題 ${index+1} / ${questions.length}`;

  document.getElementById("img").src =
    questions[index].file;
}

function answer(a){
  const q = questions[index];
  const correctFlag = (a === q.correct) ? 1 : 0;

  if(correctFlag) score++;

  // 保存形式: 画像名:回答:正解:正誤
  answers.push(
    `${q.file}:${a}:${q.correct}:${correctFlag}`
  );

  index++;

  if(index >= questions.length){
    finish();
    return;
  }
  show();
}

function finish(){
  const result = answers.join(",");

  // ===== スプレッドシート送信 =====
  fetch("https://script.google.com/macros/s/AKfycbwHCsoQaIbzWGPd5Ft8dAHVV4EWoJwPHtyB5i6rdQWZiqREAjQJsmIw4TgW3-M18GmU/exec", {
    method: "POST",
    body: new URLSearchParams({ data: result })
  });

  document.body.innerHTML =
    `<h2>終了</h2>
     <p>正答数：${score} / ${questions.length}</p>`;
}

show();
</script>

</body>
</html>

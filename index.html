<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>判定テスト</title>
<style>
    body { text-align:center; font-family:sans-serif; padding-top: 50px; background-color: #f9f9f9; }
    img { max-width:90%; max-height:60vh; border: 2px solid #ddd; margin: 10px 0; border-radius: 8px; background-color: #fff; }
    
    /* ボタンの共通スタイル */
    button { font-size:24px; margin:10px; padding:15px 40px; cursor: pointer; border-radius: 8px; border: none; transition: 0.2s; }
    button:active { transform: scale(0.95); }

    /* 開始ボタン */
    .btn-start { background-color: #4CAF50; color: white; }
    
    /* 回答ボタンの色分け（お好みで） */
    .btn-mesial { background-color: #2196F3; color: white; }
    .btn-distal { background-color: #FF9800; color: white; }

    input { font-size:18px; padding:12px; width: 280px; border: 1px solid #ccc; border-radius: 4px; margin-bottom: 20px; }
    #quiz-container { display: none; }
</style>
</head>

<body>

<div id="setup-container">
    <h2>判定テスト</h2>
    <div>
        <input id="username" placeholder="名前を入力してください">
    </div>
    <button class="btn-start" onclick="startQuiz()">テスト開始</button>
</div>

<div id="quiz-container">
    <h2 id="counter"></h2>
    <img id="img"><br>
    <div>
        <button class="btn-mesial" onclick="answer('近心')">mesial</button>
        <button class="btn-distal" onclick="answer('遠心')">distal</button>
    </div>
</div>

<script>
// ===== 問題生成（40枚）=====
const problems = [];
["1distal","1mesial","2distal","2mesial"].forEach(type=>{
  for(let i = 1; i <= 10; i++){
    problems.push({
      file: `github-dental/${type} (${i}).jpg`,
      correct: type.includes("distal") ? "distal" : "mesial"
    });
  }
});

// ===== 変数管理 =====
const shuffled = [...problems].sort(() => Math.random() - 0.5);
const questions = shuffled.slice(0, 20); 
let index = 0;
let score = 0;
const answers = [];

// ===== 1. テスト開始処理 =====
function startQuiz() {
    const name = document.getElementById("username").value.trim();
    if(!name) {
        alert("名前を入力してから開始してください");
        return;
    }
    document.getElementById("setup-container").style.display = "none";
    document.getElementById("quiz-container").style.display = "block";
    show();
}

// ===== 2. 問題表示 =====
function show(){
    document.getElementById("counter").textContent = `問題 ${index + 1} / ${questions.length}`;
    document.getElementById("img").src = questions[index].file;
}

// ===== 3. 回答処理 =====
function answer(a){
    const q = questions[index];
    const correctFlag = (a === q.correct) ? 1 : 0;
    if(correctFlag) score++;

    answers.push(`${q.file}:${a}:${q.correct}:${correctFlag}`);
    index++;

    if(index >= questions.length){
        finish();
        return;
    }
    show();
}

// ===== 4. 終了・送信処理 =====
function finish(){
    const name = document.getElementById("username").value;
    const combinedData = `${name},${answers.join(",")}`;

    fetch("https://script.google.com/macros/s/AKfycbwHCsoQaIbzWGPd5Ft8dAHVV4EWoJwPHtyB5i6rdQWZiqREAjQJsmIw4TgW3-M18GmU/exec", {
        method: "POST",
        mode: "no-cors",
        body: new URLSearchParams({
            data: combinedData
        })
    });

    document.body.innerHTML =
      `<div style="padding-top:50px;">
          <h2>テスト終了</h2>
          <p>お疲れ様でした、<strong>${name}</strong> さん</p>
          <p style="font-size:24px; color:#d32f2f;">正答数：${score} / ${questions.length}</p>
          <button class="btn-start" onclick="location.reload()">もう一度受ける</button>
       </div>`;
}
</script>

</body>
</html>
